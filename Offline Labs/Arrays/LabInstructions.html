<!DOCTYPE html>
<!-- saved from url=(0047)https://labondemand.com/LabProfile/Manual/LABID -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width">
    <title>Local Lab Instructions</title>


    <script src="./Content/jquery-2.1.4.min.js.download" type="text/javascript"></script>
    <script src="./Content/showdown.min.js.download"></script>
    <link rel="stylesheet" type="text/css" href="./Content/prettify.css">
    <script src="./Content/yaml.min.js.download"></script>
    <script src="./Content/LocalizeTo" type="text/javascript"></script>
    <link href="./Content/CloudClient.css" rel="stylesheet" type="text/css">
  
    <style type="text/css">
        body, html {
            font-family: Segoe UI,Tahoma,Verdana,Arial,sans-serif;
            font-size: 14px;
            padding: 0;
            margin: 0;
            background-color: #efefef;
            color: #000;
            height: 100%;
        }

        body {
            overflow:auto;
        }

        #outputWrapper {
            background-color: #efefef;
            min-height:100%;
        }

        .instructionsPreview {
            padding: 20px;
            height: 100%;
        }

        .instructionsPreview .page {
            position:relative;
            display: block !important;
            padding: 15px 20px;
            background-color:#fff;
            page-break-after: always;
            min-height:40px;
        }

        .instructionsPreview .page:not(:first-child) {
            margin-top:20px;
        }

        @media print {
            body, html{
                height:auto;
            }
            
            body {
                -webkit-print-color-adjust: exact;
            }

            div {
                page-break-inside: avoid;
            }

            #outputWrapper {
                background-color: transparent;
            }

            .instructionsPreview {
                padding: 0;
            }

            .instructionsPreview .page:not(:first-child) {
                margin-top: 0px;
            }

        }

        @page {
            margin-left: 1.5cm;
            margin-right: 1.5cm;
            margin-top: 1.5cm;
            margin-bottom: 1.5cm;
        }
    </style>
    <link id="themeStylesheet" href="./Content/Blue.css" rel="stylesheet">

</head>
<body>
    <div id="outputWrapper">
                <div id="instructions" class="instructionsPreview">
    </div>
    <input type="hidden" id="rawContent" value="
[TemplateVersion]:
&#39;1.1&#39;

[LODLabID]:
&#39;40025&#39;

[LODLabNumber]:
&#39;08 FS.Arrays&#39;

[AdminPowerShell]:
```
powershell -NoProfile -command &quot;Start-Process powershell -Verb RunAs&quot;
exit
```

[AdminPowerShellISE]:
```
powershell -NoProfile -command &quot;Start-Process powershell_ise -Verb RunAs&quot;
exit
```

# Welcome student to the module: Arrays
An **array** is a **data structure** that is designed to store a **collection** of objects, called **elements**, and can contain elements of the same type or different types. Throughout this lab you will work with and understand working with arrays in PowerShell.

Estimated time to complete this lab: **60 minutes**

## Module Objective
After completing this lab you will be able to:
- Create arrays.
- Access, add, and modify items in arrays.
- Format array items in output.
- Work with array lists.

===

# Login to Windows 10 and Start the Lab

Login to **win10(wdt** machine with the given credentials. You can find them on the **Resources** pane.

Please login with Username: **+++Power+++** and Password: **+++Pa$$w0rd+++**

After logging in wait until you see the &quot;Lab preparation has been completed&quot; in the action center (This can take up to 2 minutes). If this does not popup you can click in the bottom right of the VM to open the action center. Begin by opening Windows PowerShell ISE by right clicking on the PowerShell icon and selecting **Run ISE as an Administrator**, or by clicking @[Run ISE as Administrator.][AdminPowerShellISE]{shell visible}.

> [!TIP] **Notes about using the lab**
> - It might take a moment to start ISE if you click the above link
> - You can click the **+++Type Text+++** icon to enter the highlighted text at the position of the cursor in the virtual machine. You can also click on the **++Copy to Clipboard++** icon and then paste in at the desired destination.
> - Entering your code in the script pane of the ISE will allow for better troubleshooting if you find errors
> - Remember that the PowerShell ISE will allow you to highlight multiple lines of PowerShell code and run them together by pressing **F8**

===

# Exercise 1: Creating arrays
An **array** is a **data structure** that is designed to store a **collection** of **objects**, called **elements**, and can contain elements of the same type or different types. There are several methods for creating and working with arrays in PowerShell. Throughout this exercise you will work with and understand these methods. The arrays created in the first task will be used throughout the exercise.

## Objectives
After completing this exercise, you will be able to:
- Create arrays.
- Return individual elements in an array.
- Modify array elements.
- Work with Array Lists.

===

# Task 1.1: Creating arrays

There are **three** common methods for creating new arrays:
  - Assigning a list of objects separated by commas.
  - redirecting the output of a cmdlet.
  - using sub-expression notation.

> [!Note] **Note:** The arrays you create in the first task will be used throughout the lab.

1. [] Begin by opening Windows **PowerShell ISE** by right clicking on the PowerShell icon and selecting **&quot;Run ISE as an Administrator&quot;**, or by clicking @[Run ISE as Administrator.][AdminPowerShellISE]{shell visible}.

2. [] Run +++cd C:\PShell\Labs+++ in your PowerShell window to navigate to your lab directory.

3. [] One technique for creating arrays is to comma-separate a list of values. Create an array with the following 5 elements: **Alpha, Green, 1, Beta, 2** and store the array in a variable called **$Array**

    <details>
    <summary>Sample Array</summary>

    ```PowerShell-notab-nocopy
    $Array = &#39;Alpha&#39;, &#39;Green&#39;, 1, &#39;Beta&#39;, 2
    ```
    </details>

4. [] Return all of the array items by calling +++$Array+++. Note that each of the items in your array are returned as they were initially defined.

5. [] Another method to create an array is to capture the **output of a cmdlet** into a variable. Create a second array called **$OutputArray** that contains all of the files and folders in your current directory (**C:\PShell\Labs**) using +++Get-ChildItem+++.

    <details>
    <summary>Cmdlet Output Array</summary>

    ```PowerShell-notab-nocopy
    $OutputArray = Get-ChildItem
    ```
    </details>

6. [] Return all of the array items by calling +++$OutputArray+++. Note that the output returns a list of all files and folders that were listed in the directory.

7. [] Objects in an array can be passed through the pipeline to other cmdlets. Try passing the objects in **$OutputArray** into **Get-Member**. You should see two different types of objects, **System.IO.DirectoryInfo** and **System.IO.FileInfo**:

    +++$OutputArray | Get-Member+++

8. [] You can also use the sub-expression definition, **@()**,  to create a new array, including an empty array. This is useful for defining an array before populating it. Create a third array called **$EmptyArray** by using the array sub-expression without any items defined.

    <details>
    <summary>Empty Array</summary>

    ```PowerShell-notab-nocopy
    $EmptyArray = @()
    ```
    </details>

9.  [] Since the array is empty, you will not see any output when calling the array variable, however, you can look at the object type to verify it is an array. Return the object type for **$EmptyArray** by calling the **.GetType()** method on the array. Note that the type reflects that it is an array. You can get the array type for the previous two arrays ($OutputArray, $Array) and see the same type for all three.

     +++$EmptyArray.GetType()+++

===

# Task 1.2: Working with array elements

Individual **elements** in an array can be called by using **index notation**. To use index notation, place the **index** value inside of square brackes, after the array name.

>[!Note] **Note:** When working with arrays, the first index value is always **&quot;0&quot;**.

For example, **$Array[0]** would return the first **element** (**index 0**) in $Array.
Index notation can also be used to replace an element with a new element.

1. [] Using **$Array**, created in Task 1.1, use index notation to return the value of **Green** by running:

    +++$Array[1]+++

    <details>
    <summary>Array from previous task</summary>

    ```PowerShell-notab-nocopy
    $Array = &#39;Alpha&#39;, &#39;Green&#39;, 1, &#39;Beta&#39;, 2
    ```
    </details>

1. [] Next, change the existing element of **Green** to be a value of **Red**:

    +++$Array[1] = &#39;Red&#39;+++

1. [] Call the **$Array** variable again and note that the value has changed.

1. [] Like other objects, arrays have useful **properties** and **methods**. Array objects have two properties that can be used to return the number of elements they contain: **Count** and **length**. Use one of these properties to identify how many objects exist in **$OutputArray**.

    <details>
    <summary>Count or Length</summary>

    ```PowerShell-notab-nocopy
    $OutputArray.count
      or
    $OutputArray.length
    ```
    </details>

    >[!Knowledge] **Remember:**  array indexes begin counting at **0**. This means if you have an array with 5 elements and try to call an array index of 5, you will not return an object. This is because even though you have objects 1-5, the index values are really 0-4. In some programming languages you will receive an &quot;out of bounds&quot; error, but PowerShell simply returns nothing.

1. [] Because arrays **count from zero**, the last index is actually the *count minus one*. For example, if there are **5 elements** in an array, they are **indexed 0-4** and the count would be 5. An easier way to access the last element is by using a **negative index** value, such as -1, which will take the count-1 and start at the end of the array.

    +++$Array[-1]+++

    +++$Array[$array.count -1]+++

    Use **negative indexing** to access the *second to last* element in **$Array**, which should be &#39;beta&#39;

    <details>
    <summary>Second to last element</summary>

    ```PowerShell-notab-nocopy
    $Array[-2]
    ```
    </details>


1. [] Array indexes can utilize several other modifiers to return only the indexes you are looking for.

    1. [] **Commas** can be used to separate index values:

        +++$Array[0,2,4]+++
    1. [] **Two periods** between index values will use that range of index values:

        +++$Array[2..4]+++
    1. [] **Variables** can be used to pass an index value:

        ```PowerShell-notab
        $i = 3
        $Array[$i]
        ```

1. [] Use what you have learned so far to return the following values from **$OutputArray**:

     1. [] The first through third elements.
     1. [] The second to last element.
     1. [] The second and fourth elements.

    <details>
    <summary>Solution</summary>

    ```PowerShell-notab-nocopy
    $OutputArray[0..2]
    $OutputArray[-2]
    $OutputArray[1,3]
    ```
    </details>

===

# Task 1.3 Working with arrays

While working with arrays, you may want to add new elements or sort the order. Arrays are created with a **fixed size**, which can be problematic when you add new items. Arrays store elements in the order that they are listed during assignment.

1. [] Call the **$Array** variable to view the order of the elements, notice how they return in the same order they were defined in the first task.

    <details>
    <summary>Array from previous task</summary>

    ```PowerShell-notab-nocopy
    $Array = &#39;Alpha&#39;, &#39;Red&#39;, 1, &#39;Beta&#39;, 2
    ```
    </details>

1. [] Use **Sort-Object** and a pipeline to sort the elements in **$Array**:

    +++$Array | Sort-Object+++

1. [] Notice that the output returned is now sorted. Call +++$Array+++ again. Are the elements still sorted?

    <details>
    <summary>Answer</summary>
    No, the elements are no longer sorted.
    </details>

1. [] When sorting an array as you did in the previous step, it will only sort the **output**, it will not save the sorted output *back into the array variable*. You can redirect the output to a new variable of the same name to save the sorted order:

    +++$Array = $Array | Sort-Object+++

1. [] To add an object to an array you would set the array equal to itself and set the value to itself plus the new object. You can also use the **+=** operator to perform the same task. Use one of these options to add **blue** to **$Array**.

    <details>
    <summary>Add to an array</summary>

    ```PowerShell-notab-nocopy
    $Array = $Array + &quot;Blue&quot;
      or
    $Array += &quot;Blue&quot;
    ```
    </details>

1. [] Return the objects saved in **$Array** again. This time you should see *blue* added to the end of the array.

    >[!Knowledge] If you look at the members of an array object, you will see a method called *.add()*. This method is designed to increase the size of a collection, however, since arrays are of a fixed length, this method is unable to do so. This lab will cover another collection that uses the .add() method in a later task.

1. [] Use the above technique to add the following to your array:

    1. [] &quot;Delta&quot;

    1. [] &quot;Yellow&quot;

    1. [] 3.1415926 - &quot;*Do not place quotes around this*&quot;

    <details>
    <summary>Add elements to an array</summary>

    ```PowerShell-notab-nocopy
    $Array += &quot;Delta&quot;
    $Array += &quot;Yellow&quot;
    $Array += 3.1415926
    ```
    </details>

1. [] Call +++$Array+++ again to see the new items have been added to the end of the array, and that they are not sorted.

===

# Task 1.4 Other array operators

Arrays can utilize a few special operators to work with the elements contained. These include: **Format, Contains, In, Split, and Join**.

After all the adding and sorting from the previous section, **$Array** should look like this:

+++$array = 1, 2, &quot;Alpha&quot;, &quot;Beta&quot;, &quot;Red&quot;, &quot;Blue&quot;, &quot;Delta&quot;, &quot;Yellow&quot;, 3.1415926+++


1. [] Array index numbers can be used with the **format operator** to fetch a specific element and **apply special formatting**. To achieve this, there are 3 main pieces:

    - the *string*.
    - the *operator*.
    - the *array*.

    First, a string is created leveraging placeholders that look like this: **&quot;{index number}&quot;**.
    Then the format operator &quot;**-f**&quot; is used, followed by the array of values.

	+++&quot;this is a placeholder for the first element {0}&quot; -f $array+++

    >[!Tip] **Remember:** array indexes start at zero!

    Use the format operator to display: &quot;Alpha, Beta, Delta&quot;

    <details>
    <summary>Solution</summary>

    ```PowerShell-notab-nocopy
    &quot;{2}, {3}, {6}&quot; -f $array
    ```
    </details>

1. [] As mentioned, the format operator can apply special formatting during this process. To apply special formatting, the placeholder will leverage a **colon** followed by a **code** with this syntax: **{IndexNumber:CODE}**. There are many codes available, which are mostly used for displaying numbers and dates.

    **&quot;N&quot;** can be used to standardize and round numbers:

	+++&quot;look at this number: {0:N}&quot; -f 5555555555555.12345+++

    Notice it automatically adds the **commas** and rounds to **2 decimal** places. To control the rounding you can provide a **number** attached to **&quot;N&quot;**, like this:

    +++&quot;look at this number: {0:N1}&quot; -f 5555555555555.12345+++

    Use this technique to round the pi value (3.1415926) from $Array to 3 decimal places

    <details>
    <summary>Solution</summary>

    ```PowerShell-notab-nocopy
    &quot;Pi is {8:n3}&quot; -f $Array
    ```
    </details>


    >[!Note] **Note:** negative indexes are not supported by the format operator.

    >[!Knowledge]
    > **&quot;P&quot;** can be used to turn floating point numbers into percentages.
    >
     **&quot;C&quot;** can be used to convert numbers to represent currency.
    >
    Other codes can be difficult to find on the [docs page](https://docs.microsoft.com/en-us/dotnet/api/system.string.format?view=net-6.0), but using it with **[datetime]** objects is another common use.

1. [] It is very common to not know what exact values are stored inside of an array. To identify whether a value is present in an array you can use either **-Contains** or **-In**. Each of these will return a true or false output.

   1. [] The **-Contains** operator will check to see if an Array contains an element by using the following format:

        +++$Array -contains &quot;Beta&quot;+++

   1. [] The **-In** operator will check if the item is in the array:

        +++&quot;Beta&quot; -in $Array+++

    >[!Knowledge] &quot;**-Contains**&quot; and &quot;**-In**&quot; both perform similar tasks. The key difference between these two is the order that they are used, *is this* **item in collection** or *does this* **collection contains item**.

1. [] PowerShell includes an operator that allows for a single string to be split into an array of strings called &quot;**-Split**&quot;.

    Run the following and observe that the string is split at each comma and the comma is removed from the output:

    +++&quot;This,Is,A,Single,String,With,Commas&quot; -split &quot;,&quot;+++

1. [] Run the same command but put the resulting output into a variable, **$Split**, so you can interact with it:

    +++$Split = &quot;This,Is,A,Single,String,With,Commas&quot; -split &quot;,&quot;+++

1. [] Now that you have saved the output into a variable, you can call the array to view all of the elements. You can also run the **.GetType()** method to identify that it really is an array:

    +++$Split.GetType()+++

    Use what you&#39;ve learned so far to access the string &quot;Commas&quot; from your **$Split** array

    <details>
    <summary>Solution</summary>

    ```PowerShell-notab-nocopy
    $Split[-1]
    ```
    </details>

1. [] The **-Join** operator can recieve an array of strings and combine them into a single string with a specified delimiter. This will use the **$Split** array to make a single string, separated with dashes:

    +++$Split -Join &quot;-&quot;+++

    >[!Knowledge] The **-split** operator will use a default delimiter of a space.
    >
    >The **-join** operator will use a delimiter of null.
    >
    >Each of these operators can accept whatever delimiter you need to use by specifying it within the quotes. *Delimiters can be as many characters as you&#39;d like.*

===

# Task 1.5 Array lists

At the beginning of the lab, you learned that arrays are created with a fixed size. Because of this, you cannot dynamically add elements to them.

However, another type of collection, called an **Array List**, behaves very similarly to an array and allows for adding of elements efficiently.

1. [] Array lists are created with the **New-Object** cmdlet. Create a new Array List by running:

    +++$ArrayList = New-Object -TypeName System.Collections.ArrayList+++

1. [] Run +++$ArrayList.GetType()+++ to identify the type of object you have created. Note that this is an **ArrayList** and not an **Array**.

1. [] The ArrayList you just created has no elements in it. In order to add elements, you will use the **.Add()** method. Run the following to add an element:

    +++$ArrayList.Add(&quot;Red&quot;)+++

1. [] After running the **.Add()** method, you will see a number in the output. This number is the index value for the element in the array list. You can hide this from the output by piping to **Out-Null**. Add another element and hide the index output:

    +++$ArrayList.Add(&quot;Green&quot;) | Out-Null+++

    Even though the output was hidden with **Out-Null**, the action still happened. +++$ArrayList+++ will show both elements.

1. [] Earlier you used the **+=** operator to add items to your array. Try to use this technique to add to your array list:

    ```PowerShell-notab-nocopy
    $ArrayList += &quot;Blue&quot;
    $ArrayList
    ```

1. [] Note that the new element *seems to* have been added to the arraylist like before. Try adding another element with the **.Add()** method. **You should recieve an error**.

    +++$ArrayList.Add(&quot;Orange&quot;)+++

1. [] The error should look like this:

    *Exception calling &quot;Add&quot; with &quot;1&quot; argument(s): &quot;Collection was of a fixed size.&quot;*.

    ArrayLists are not fixed sizes, but arrays are. Check the type of $ArrayList with **.GetType()**. You should now see that it has been converted to an Array, instead of an ArrayList.

    >[!Knowledge] The above scenario of using **+=** to add to an ArrayList and accidentally converting it to an Array is a very common mistake. *Adding to an ArrayLists can only be done by using methods*. Always be aware of this when working with them.

1. [] Aside from *adding* to an **ArrayList** using a method, and *creating* it using **New-Object**, they will feel exactly like a normal array with how you access them. To investigate, play with the following examples:

    1. [] Create and populate an Array List:

        ```PowerShell-notab-nocopy
        $ArrayList = New-Object -TypeName System.Collections.ArrayList
        $ArrayList.Add(&quot;Red&quot;) | Out-Null
        $ArrayList.Add(&quot;Green&quot;) | Out-Null
        $ArrayList.Add(&quot;Yellow&quot;) | Out-Null
        $ArrayList.Add(&quot;Blue&quot;) | Out-Null
        ```

    1. [] Access it:

        ```PowerShell-notab-nocopy
        $ArrayList[0]
        $ArrayList[-1]
        $ArrayList[0,2]

        $ArrayList.Count
        $ArrayList[0].ToUpper()
        ```

    1. [] Change it:

        ```PowerShell-notab-nocopy
        $ArrayList[0] = &quot;Purple&quot;
        $ArrayList[0]
        ```

===

# Self test (Optional part of the course)

## Self test information

The following self test is a optional part of this course and can be used to evaluate if your knowledge of the subject matter is sufficient. You can use this self test to re-evaluate your knowledge after taking the course or test your knowledge before you take / retake the course.

This self test exists out of 10 questions and or exercises. To get a fair result you should complete this self test using your knowledge only and not using any internet search engines.

##  Self test duration

Although the self test is not timed this test should be completed in approximately 15 minutes.

To start the self test continue to the next page.

===

## Self test

1. <Removed>
___
2. <Removed>
___
3. <Removed>
___
4. <Removed>
___
5. <Removed>
___
6. <Removed>
___
7. <Removed>
___
8. <Removed>
___
9. <Removed>
___
10. <Removed>
">
    <input type="hidden" id="activities" value="[]">
    <input type="hidden" id="replacementTokens" value="[{&quot;Token&quot;:&quot;@lab.LabProfile.Id&quot;,&quot;Replacement&quot;:&quot;38671&quot;},{&quot;Token&quot;:&quot;@lab.CtrlAltDelete&quot;,&quot;Replacement&quot;:&quot;&lt;a href=&#39;#&#39; class=&#39;ctrlAltDeleteLink&#39;&gt;Ctrl+Alt+Delete&lt;/a&gt;&quot;},{&quot;Token&quot;:&quot;@lab.VirtualMachine(WIN10).SelectLink&quot;,&quot;Replacement&quot;:&quot;&lt;a href=&#39;#&#39; class=&#39;selectMachineLink&#39; data-data=&#39;63124&#39;&gt;WIN10&lt;/a&gt;&quot;},{&quot;Token&quot;:&quot;@lab.VirtualMachine(WIN10).Username&quot;,&quot;Replacement&quot;:&quot;Power&quot;},{&quot;Token&quot;:&quot;@lab.VirtualMachine(WIN10).Password&quot;,&quot;Replacement&quot;:&quot;Pa$$$$w0rd&quot;},{&quot;Token&quot;:&quot;@lab.VirtualMachine(MS).SelectLink&quot;,&quot;Replacement&quot;:&quot;&lt;a href=&#39;#&#39; class=&#39;selectMachineLink&#39; data-data=&#39;54597&#39;&gt;MS&lt;/a&gt;&quot;},{&quot;Token&quot;:&quot;@lab.VirtualMachine(MS).Username&quot;,&quot;Replacement&quot;:&quot;Power&quot;},{&quot;Token&quot;:&quot;@lab.VirtualMachine(MS).Password&quot;,&quot;Replacement&quot;:&quot;Pa$$$$w0rd&quot;},{&quot;Token&quot;:&quot;@lab.VirtualMachine(DC).SelectLink&quot;,&quot;Replacement&quot;:&quot;&lt;a href=&#39;#&#39; class=&#39;selectMachineLink&#39; data-data=&#39;54598&#39;&gt;DC&lt;/a&gt;&quot;},{&quot;Token&quot;:&quot;@lab.VirtualMachine(DC).Username&quot;,&quot;Replacement&quot;:&quot;Administrator&quot;},{&quot;Token&quot;:&quot;@lab.VirtualMachine(DC).Password&quot;,&quot;Replacement&quot;:&quot;Pa$$$$w0rd&quot;},{&quot;Token&quot;:&quot;@lab.OpticalMedia(5638).LoadLink&quot;,&quot;Replacement&quot;:&quot;&lt;a href=&#39;#&#39; class=&#39;loadMediaLink opticalMedia&#39; data-data=&#39;5638&#39;&gt;Introduction to Commands - 0050&lt;/a&gt;&quot;},{&quot;Token&quot;:&quot;@lab.LabInstance.Id&quot;,&quot;Replacement&quot;:&quot;[ID]&quot;},{&quot;Token&quot;:&quot;@lab.LabInstance.GlobalId&quot;,&quot;Replacement&quot;:&quot;[lodID]&quot;},{&quot;Token&quot;:&quot;@lab.LabInstance.StartDate&quot;,&quot;Replacement&quot;:&quot;20190108&quot;},{&quot;Token&quot;:&quot;@lab.User.Id&quot;,&quot;Replacement&quot;:&quot;[USERID]&quot;},{&quot;Token&quot;:&quot;@lab.User.FirstName&quot;,&quot;Replacement&quot;:&quot;[FIRSTNAME]&quot;},{&quot;Token&quot;:&quot;@lab.User.LastName&quot;,&quot;Replacement&quot;:&quot;[LASTNAME]&quot;},{&quot;Token&quot;:&quot;@lab.User.Email&quot;,&quot;Replacement&quot;:&quot;[EMAIL]&quot;},{&quot;Token&quot;:&quot;@lab.User.ExternalId&quot;,&quot;Replacement&quot;:&quot;[EXTERNALID]&quot;},{&quot;Token&quot;:&quot;@lab.Tag&quot;,&quot;Replacement&quot;:&quot;[TAG]&quot;}]">

    <textarea id="copyInput" value="" style="position: absolute; left:-10000px; top:-10000px; "></textarea>

    <script type="text/javascript"> 
    
        String.prototype.replaceAll = function(search, replacement) {
            var target = this;
            return target.replace(new RegExp(search, 'g'), replacement);
        };

        var childWindows = [];

        function showClickFeedbackMessage(text, x, y, duration) {
            var $message = $("<div class='clickFeedbackMessage noselect'>" + text + "</div>");
            $message.appendTo($("body")).hide();
            $message.css({ left: x, top: y });
            $message.fadeIn("fast");
            window.setTimeout(function () {
                $message.fadeOut("fast", function () { $message.remove(); });
            }, duration);
        }

        function copyableClicked(element) {
            //only copy if we are clicking, not if we have used the mouse to select the text manually.
            var selectedText;
            if (window.getSelection) {
                selectedText = window.getSelection().toString();
            } else if (document.selection && document.selection.type !== "Control") {
                selectedText = document.selection.createRange().text;
            }
            if (selectedText) { return };

            var $element = $(element);
            var text = $element.text();
            $("#copyInput").val(text).select();
            var offset = $element.offset();
            var x = offset.left;
            var y = offset.top - 40;
            try {
                var successful = document.execCommand("copy");
                if (successful) {
                    showClickFeedbackMessage("Copied to clipboard", x, y, 2000);
                } else {
                    showClickFeedbackMessage("Copying was unsuccessful", x, y, 2000);
                }
            } catch (err) {
                showClickFeedbackMessage("Copying was unsuccessful", x, y, 2000);
                console.log("Unable to copy. " + err);
            }
        }

        function setupKnowledgeExpanders() {
            $(".knowledge").each(function () {
                var knowledge = this;
                var $knowledge = $(this);
                var $moreKnowledge = $knowledge.next();
                if ($moreKnowledge.is(".moreKnowledge")) {
                    var maxHeight = 100;
                    var leeway = 100;
                    var diff = knowledge.scrollHeight - maxHeight;
                    if (diff < leeway) {
                        $knowledge.removeClass("collapsed");
                        $moreKnowledge.find("a").hide();
                    } else {
                        //this is tall content, let's show the 'more' link
                        $moreKnowledge.find("a").show();
                        $knowledge.addClass("collapsed");
                    }
                }
            });
        }

        var variables = {};

        function processVariables() {
            $("span.variable").each(function () {
                var $this = $(this);
                var name = $this.attr("data-name");
                if (name in variables) {
                    $this.html(variables[name]);
                } else {
                    $this.text("<" + name + ">");
                }
            });
            $("input.variableTextBox").each(function () {
                var $this = $(this);
                var name = $this.attr("data-name");
                if (name in variables) {
                    $this.val(variables[name]);
                } else {
                    $this.val("");
                }
            });
            $("code").each(function () {
                var originalHtml = this.originalHtml ? this.originalHtml : this.innerHTML;
                var newHtml = originalHtml;
                for (var name in variables) {
                    var val = variables[name];
                    var regex = new RegExp('<span class="nocode">&lt;' + name + '&gt;</span>', 'g');
                    newHtml = newHtml.replace(regex, val);
                }
                if (originalHtml != newHtml || originalHtml != this.innerHTML) {
                    this.originalHtml = originalHtml;
                    this.innerHTML = newHtml;
                }
            });
        }
        
        window.onload = function () {

            var rawContent = document.getElementById("rawContent").value;
            var contentRoot = "./Content/"
            var activitiesString = document.getElementById("activities").value;
            var activities = (activitiesString == null || activitiesString.length == 0) ? [] : JSON.parse(activitiesString);
            var replacementTokensString = document.getElementById("replacementTokens").value;
            var replacementTokens = (replacementTokensString == null || replacementTokensString.length == 0) ? [] : JSON.parse(replacementTokensString);
            instructionsProcessor.process(rawContent, "instructions", false, contentRoot, replacementTokens,
                function ($page) {
                    setupKnowledgeExpanders();
                },
                activities
            );
            $(".page").each(function () {
                var $page = $(this);
                if ($page.find("iframe.externalManual").length > 0) {
                    $page.css("padding", 0);
                }
            });

            $("body").on("click", ".moreKnowledgeLink", function (e) {
                e.preventDefault();
                var $link = $(this);
                var $knowledge = $link.parent().prev();
                if ($knowledge.hasClass("expanded")) {
                    $knowledge.removeClass("expanded");
                    $link.text("more...");
                } else {
                    $knowledge.addClass("expanded");
                    $link.text("...less");
                }
            }).on("click", ".copyable, code:not(.nocopy)", function (e) {
                copyableClicked(this);
            }).on("click", ".dialogLink", function (e) {
                e.preventDefault();
                e.stopImmediatePropagation();
                var $dialogLink = $(this);
                var title = $dialogLink.attr("title");
                var target = $dialogLink.attr("data-target");
                if (target) {
                    var $hiddenDialog = $("blockquote.referenceContent[data-id='" + target + "']");
                    if ($hiddenDialog.length === 0) {
                        alert('CONTENT ERROR: Unable to find a reference content "' + target + '"');
                    } else {
                        showDialog({title:title, content: $hiddenDialog.html() });
                    }
                }
                else {
                    showDialog({title:title, url: $dialogLink.attr("href"), isInstructions: $dialogLink.hasClass("instructions") });
                }
            }).on("click", ".videoLink, video", function (e) {
                e.preventDefault();
                var videoUrl = $(this).hasClass("videoLink") ? this.href : this.src;
                var url = "./Content/" + videoUrl.split('Content/').pop().replace(/\#(.*?)$/, '').replace(/\?(.*?)$/, '')
                if (this.title) {
                    
                }
                var videoWindow = window.open(url, "videoWindow", "menubar=no,location=no,resizable=yes,scrollbars=yes,status=no");
                childWindows.push(videoWindow);
                try {
                    videoWindow.focus();
                } catch (e) {

                }
            }).on("click", ".imageLink, img", function (e) {
                var $this = $(this);
                if ($this.parent().is("a")) return;
                e.preventDefault();
                e.stopImmediatePropagation();
                var imgUrl = $this.hasClass("imageLink") ? this.href : this.src;
                var url = "./Content/" + imgUrl.split('Content/').pop().replace(/\#(.*?)$/, '').replace(/\?(.*?)$/, '')
                if (this.title) {
                    
                }
                var imageWindow = window.open(url, "imageWindow", "menubar=no,location=no,resizable=yes,scrollbars=yes,status=no");
                childWindows.push(imageWindow);
                try {
                    imageWindow.focus();
                } catch (e) {

                }
            }).on("click", ".tipLink", function (e) {
                e.preventDefault();
                var $tiplink = $(this);
                var $hiddenTip = $tiplink.next();
                var offset = $(this).offset();
                var x = offset.left;
                var y = offset.top + 25;
                showClickFeedbackMessage($hiddenTip.html().replaceAll('<code title="Copy to clipboard" class="prettyprint">','<code title="Copy to clipboard" style="background-color:#8888;" class="prettyprint">').replaceAll("class",'style="background-color:#8888;" class'), x, y, 5000);
            }).on("change", ".variableTextBox", function () {
                var $textBox = $(this);
                var name = $textBox.attr("data-name");
                var val = $textBox.val();
                if (val == null || val.length == 0) {
                    if (name in variables) {
                        delete variables[name];
                    }
                } else {
                    variables[name] = val;
                }
                processVariables();
            });;

            $(window).resize(function () {
                setupKnowledgeExpanders();
            }).unload(function () {
                closeAllChildWindows();
            });

            function closeAllChildWindows() {
                for (var i = 0; i < childWindows.length; i++) {
                    try {
                        childWindows[i].close();
                    } catch (e) {
                    }
                }
                childWindows = [];
            }

            function showDialog(options) {
                if (!options) return;
                var $dialog = $("#modalDialog");
                var isUpdatedContent = false;
                if ($dialog.length > 0) {
                    $dialog.find(".dialogContent").html("");
                    $dialog.find(".dialogButtons").html("");
                    isUpdatedContent = true;
                } else {
                    var $dialog = $('<div id="modalDialog" class="dialog"><div class="dialogMask"></div><div class="dialogBox"><div class="dialogCloseButton"></div><div class="dialogTitle"></div><div class="dialogContent"></div><div class="dialogButtons"></div></div></div>');
                }
                var $dialogBox = $dialog.find(".dialogBox");
                var close = function () {
                    var h = $dialogBox.outerHeight();
                    var offset = $dialogBox.offset();
                    $dialogBox.css("marginTop", 0).animate({ marginTop: -h - offset.top }, 300);
                    $dialog.delay(200).fadeOut("fast", function () { $dialog.remove(); });
                }
                $dialog.find(".dialogCloseButton").click(close);

                if (options.title) {
                    $dialog.find(".dialogTitle").html(options.title).show();
                } else {
                    $dialog.find(".dialogTitle").hide();
                    $dialog.addClass("noTitle");
                }
                if (options.content) {
                    $dialog.find(".dialogContent").removeClass("noScroll").append(options.content);
                } else if (options.url) {
                    var urlLower = options.url.toLowerCase();
                    if (urlLower.indexOf(".mp4") !== -1) {
                        $dialog.find(".dialogContent").removeClass("noScroll").append('<video src="' + options.url + '" controls autoplay></video>');
                        var $video = $("#contentDialogVideo");
                        try {
                            $video[0].play();
                        } catch (e) {
                            //
                        }
                    } else if (urlLower.indexOf(".png") !== -1 || urlLower.indexOf(".jpg") !== -1 || urlLower.indexOf(".jpeg") !== -1 || urlLower.indexOf(".gif") !== -1) {
                        $dialog.find(".dialogContent").removeClass("noScroll").append('<img src="' + options.url + '" controls></iframe>');
                    } else if (options.isInstructions || urlLower.indexOf(".md") !== -1) {
                        $dialog.find(".dialogContent").removeClass("noScroll").append('<div id="instructionsDialog"></div>');
                        window.setTimeout(function () {
                            instructionsProcessor.processUrl(options.url, "instructionsDialog");
                            if (options.url.indexOf("#") >= 0) {
                                window.setTimeout(function () {
                                    var hash = options.url.substr(options.url.indexOf("#"));
                                    var $element = $("#instructionsDialog " + hash);
                                    if ($element.length > 0) {
                                        $dialog.find(".dialogContent").scrollTop($element.position().top);
                                    }
                                }, 400); //leave time for the content to layout... the dialog takes 400ms to animate anyway, which should be sufficient.
                            }
                        }, 1);
                    } else {
                        $dialog.find(".dialogContent").addClass("noScroll").append('<iframe id="contentDialogIFrame" src="' + options.url + '" style="width:100%;height:100%;border:none;" allowfullscreen></iframe>');
                    }
                } else {
                    $dialog.find(".dialogContent").hide();
                }
                if (options.buttons && options.buttons.length > 0) {
                    $dialog.addClass("hasButtons");
                    var $dialogButtons = $dialog.find(".dialogButtons");
                    var numButtons = options.buttons.length;
                    for (var i = 0; i < numButtons; i++) {
                        var button = options.buttons[i];
                        var $button = $("<input type='button' value='" + button.text + "' />");
                        if (button.click) {
                            $button.click(button.click);
                        }
                        if (button.primary) {
                            $button.addClass("primary");
                        }
                        if (button.closeDialog) {
                            $button.click(close);
                        }
                        $dialogButtons.append($button);
                    }
                }
                if (!isUpdatedContent) {
                    $("body").append($dialog);
                    $dialog.hide().fadeIn("fast", function () {
                        if (options.open) {
                            options.open();
                        }
                    });
                    var h = $dialogBox.outerHeight();
                    var offset = $dialogBox.offset();
                    $dialogBox.css("marginTop", -h - offset.top).animate({ marginTop: 0 }, 400);
                }
                return {
                    close: close
                };
            }

        }

        function getScrollTop() {
            return document.body.scrollTop;
        }

    </script>


</body>
</html>
