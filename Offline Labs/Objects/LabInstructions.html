<!DOCTYPE html>
<!-- saved from url=(0047)https://labondemand.com/LabProfile/Manual/LABID -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width">
    <title>Local Lab Instructions</title>


    <script src="./Content/jquery-2.1.4.min.js.download" type="text/javascript"></script>
    <script src="./Content/showdown.min.js.download"></script>
    <link rel="stylesheet" type="text/css" href="./Content/prettify.css">
    <script src="./Content/yaml.min.js.download"></script>
    <script src="./Content/LocalizeTo" type="text/javascript"></script>
    <link href="./Content/CloudClient.css" rel="stylesheet" type="text/css">
  
    <style type="text/css">
        body, html {
            font-family: Segoe UI,Tahoma,Verdana,Arial,sans-serif;
            font-size: 14px;
            padding: 0;
            margin: 0;
            background-color: #efefef;
            color: #000;
            height: 100%;
        }

        body {
            overflow:auto;
        }

        #outputWrapper {
            background-color: #efefef;
            min-height:100%;
        }

        .instructionsPreview {
            padding: 20px;
            height: 100%;
        }

        .instructionsPreview .page {
            position:relative;
            display: block !important;
            padding: 15px 20px;
            background-color:#fff;
            page-break-after: always;
            min-height:40px;
        }

        .instructionsPreview .page:not(:first-child) {
            margin-top:20px;
        }

        @media print {
            body, html{
                height:auto;
            }
            
            body {
                -webkit-print-color-adjust: exact;
            }

            div {
                page-break-inside: avoid;
            }

            #outputWrapper {
                background-color: transparent;
            }

            .instructionsPreview {
                padding: 0;
            }

            .instructionsPreview .page:not(:first-child) {
                margin-top: 0px;
            }

        }

        @page {
            margin-left: 1.5cm;
            margin-right: 1.5cm;
            margin-top: 1.5cm;
            margin-bottom: 1.5cm;
        }
    </style>
    <link id="themeStylesheet" href="./Content/Blue.css" rel="stylesheet">

</head>
<body>
    <div id="outputWrapper">
                <div id="instructions" class="instructionsPreview">
    </div>
    <input type="hidden" id="rawContent" value="[TemplateVersion]:
&#39;1.1&#39;

[LODLabID]:
&#39;40023&#39;

[LODLabnumber]:
&#39;02 FS.Objects&#39;

[AdminPowerShell]:
```
powershell -NoProfile -command &quot;Start-Process powershell -Verb RunAs&quot;
exit
```

[AdminPowerShellISE]:
```
powershell -NoProfile -command &quot;Start-Process powershell_ise -Verb RunAs&quot;
exit
```

# Welcome student to the module: Objects, Variables, Data Types

All **data** in PowerShell is represented as an **object**. This includes all of the **data** returned from cmdlets. Understanding **objects** will prevent many common **mistakes**, and provide a significant amount of **capabilities**.


An **object** consists of *three* types of data: the **type**, the **methods**, and the **properties**.
 

**Objects** can be saved in units of memory for easy access using **variables**.

Estimated time to complete this lab: **60 minutes**

## Module Objective
After completing this lab you will be able to:
- Discover object members
- Use object properties and methods
- Work with variables


===

# Login to Windows 10 and Start the Lab

Login to **win10(wdt** machine with the given credentials. You can find them on the **Resources** pane.

Please login with Username: **+++Power+++** and Password: **+++Pa$$w0rd+++**

After logging in wait until you see the &quot;Lab preparation has been completed&quot; in the action center (This can take up to 2 minutes). If this does not popup you can click in the bottom right of the Vm to open the action center. Begin by opening Windows PowerShell ISE by right clicking on the PowerShell icon and selecting **Run ISE as an Administrator**, or by clicking @[Run ISE as Administrator.][AdminPowerShellISE]{shell visible}

> [!TIP] **Notes about using the lab**
> - It might take a moment to start ISE if you click the above link
> - You can click the **+++Type Text+++** icon to enter the highlighted text at the position of the cursor in the virtual machine. You can also click on the **++Copyto Clipboard++** icon and then paste in at the desired destination.
> - Entering your code in the script pane of the ISE will allow for better troubleshooting if you find errors
> - Remember that the PowerShell ISE will allow you to highlight multiple lines of PowerShell code and run them together by pressing **F8**

===

# Exercise 1: Objects Basics

**Everything** in Windows PowerShell is an **object**. **Objects** are instances of **templates**, known as data **types** or classes.

This exercise will investigate how to discover this crucial information and manage any **object** that is encountered.

## Objectives

After completing this exercise, you will be able to:

- Understand objects and their members.
- Store objects in variables.
- Use Get-Member to return object datatype and member information.

===
# Task 1.1: Introduction to Objects

1. [] Complete the following statements by choosing the correct words from the list below.

    >[!NOTE] **methods, object, type, properties, template, members**

    A type represents a construct that defines a template of members.

    Every object has a type.

    Objects have data fields called properties.

    Objects have procedures, known as methods.

    Properties and methods are collectively known as members.

    <details>
    <summary>Answers </summary>
    A type represents a construct that defines a **Template** of members.

    Every **object** has a **type**.

    Objects have data fields called **properties**.

    Objects have procedures, known as **methods**.

    Properties and methods are collectively known as **members**.
    </details>

1. [ ] Open Windows PowerShell ISE by right clicking on the PowerShell icon and selecting &quot;Run ISE as an Administrator, or by clicking @[Run ISE as Administrator.][AdminPowerShellISE]{shell visible}.

1. [] Use **Get-Service** to return only the **Spooler** service object. How many column headers return and what are they?

    <details>
    <summary>Get-Service </summary>

    ```PowerShell-notab
    Get-Service -Name Spooler
    ```
    </details>

    <details>
    <summary>Answer </summary>

    3, Status, Name, DisplayName
    </details>

1. [] Using the **Format-List** and **Get-Service** cmdlets, show all the **properties** for the **Spooler** service as a list. How many **properties** are listed?

    >[!KNOWLEDGE] The **Format-List** cmdlet formats the output of a command as a list of properties in which each property is displayed on a separate line. Read more on official reference: knowledge[Format-List](https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.utility/format-list?view=powershell-5.1)

    <details>
    <summary>Format-List </summary>

    ```PowerShell-notab
    Format-list -InputObject (Get-Service -Name Spooler) -Property *
    ```
    </details>

    <details>

    <summary>Answer </summary>
    16
    </details>

1. [] Get the **process** information for the **&quot;lsass&quot;** process. How many **properties** are visible in the table output?

    <details>
    <summary>Get-Process</summary>

    ```PowerShell-notab
    Get-Process -Name Lsass
    ```
    </details>

    <details>
    <summary>Answer </summary>

    The Lsass process should display 8 properties.
    </details>

1. [] Create a **variable** named **$proc** to store the **lsass** process. Just like the earlier step, use **Get-Process**.

    <details>
    <summary>Save lsass to a variable</summary>

    ```PowerShell-notab
    $proc = Get-Process -Name lsass
    ```
    </details>

1. [] Format the output of **$proc** using **Format-List**. Specify that **all properties** are returned with the wildcard character **(\*)**. A long list of properties should be visible.

    <details>
    <summary>Format-List</summary>
    ```PowerShell-notab
    Format-List -InputObject $proc -Property *
    ```
    </details>

===
# Task 1.2: Get-Member and Types

A richer way to investigate the object&#39;s **members** is to use **Get-Member**. Get-Member finds the **type** of the **object** (or list of objects) and displays the type&#39;s **properties** and **methods**.

1. [] What is the **TypeName** returned from the following command?

    ```PowerShell-notab
    Get-Member -InputObject (Get-Item -Path C:\windows\system32\notepad.exe)
    ```

    <details>
    <summary>Answer</summary>
    
    System.IO.FileInfo
    </details>

1. [] The previous Get-Item cmdlet will be used more in the upcoming steps, which means it will be accessed **multiple** times. Instead of placing the **Get-Item** cmdlet in parenthesis **every** time, it is more **convenient** to store it in a **variable**. Store the output of `Get-Item -Path C:\windows\system32\notepad.exe` into a variable named **$Notepad**.

    <details>
    <summary>Save into a variable</summary>

    ```PowerShell-notab
    $Notepad = Get-Item -Path C:\windows\system32\notepad.exe
    ```
    </details>

    >[!KNOWLEDGE] **$Notepad** now saves a *copy* of the data to reuse. Changes to **$Notepad** and changes to the *actual* exe do **not** know about each other unless the command is saved to $Notepad again. Keep this in mind when working with data that needs to be *updated*.

1. [] Use **Get-help** to find a parameter that will filter **member types** on the **Get-Member** cmdlet.

    <details>
    <summary>Parameter Name</summary>

    The `MemberType` parameter allows for you to filter based on a specific member type. Using MemberType will allow *Properties* or *Methods* to be viewed.
    </details>

1. [] Use **Get-Member** to view *only* the **property** members of the object stored in **$Notepad**.

    <details>
    <summary>Get-Member Properties</summary>

    ```PowerShell-notab
    Get-Member -InputObject $Notepad -MemberType Properties
    ```
    </details>

    >[!TIP] There are different kinds of properties and methods, such as a *NoteProperty* or *AliasProperty*. They behave the same when interacting with them, so searching the plural *properties* instead of the singular *proprty* will return more results to work with.

1. [] **Modify** the previous command to display *only* the **method** members of the object stored in **$Notepad**

    <details>
    <summary>Get-Member Methods</summary>

    ```PowerShell-notab
    Get-Member -InputObject $Notepad -MemberType Methods
    ```
    </details>

1. [] Using **Start-Process**, start **Notepad.exe**.

    <details>
    <summary>Start Notepad</summary>

    ```PowerShell-notab
    Start-Process -FilePath Notepad.exe
    ```
    </details>

1. [] Create a **variable** named **$NoteProc** containing all **processes** with the process name **&quot;Notepad&quot;**.

    <details>
    <summary>Save to a variable</summary>

    ```PowerShell-notab
    $noteProc = Get-Process -Name notepad
    ```
    </details>

1. [] Using **Get-Member** parameters, find all **properties** with the string **Memory** in the property Name.

    <details>
    <summary>Hint</summary>
    Most Cmdlet parameters accept the wildcard characters ***** and  **?**
    </details>

    <details>
    <summary>Get-Member</summary>

    ```PowerShell-notab
    Get-Member -InputObject $noteProc -MemberType Properties -Name *memory*
    ```
    </details>

1. [] What is the **type** of each value in the list below?

    | Value | Name |
    |:--- |:---|
    | &#39;Microsoft&#39; | <details><summary>Answer</summary>String</details> |
    | 10 |<details><summary>Answer</summary>Int32</details>|
    | 23.7 |<details><summary>Answer</summary>Double</details>|
    | $true |<details><summary>Answer</summary>Boolean</details>|
    | Get-Service -Name Spooler |<details><summary>Answer</summary>ServiceController</details>|

1. [] If Notepad is still open, close it now.

===
# Exercise 2: Dot Notation

The Dot operator, commonly referred to as **Dot notation**, is used to **access** object **methods** and **properties**.

## Objectives

After completing this exercise, you will be able to:

- Access object properties using dot notation
- Execute object methods using dot notation
- Execute object methods with parameters

===

# Task 2.1: Accessing Object Properties

1. [] Create a variable named **$spooler** that contains only the **Spooler** service.

    <details>
    <summary>Create a variable</summary>

    ```PowerShell-notab
    $spooler = Get-Service -Name Spooler
    ```
    </details>

1. [] Use **Get-Member** to list only the **properties** of **$spooler**.

    <details>
    <summary>List Properties</summary>
    ```PowerShell-notab
    Get-Member -InputObject $spooler -MemberType Properties
    ```
    </details>

1. [] You can cycle through the variable objects **members** by typing a **dot** (.) character after the **variable name** then pressing the **tab** key. Type the following: +++$spooler.+++

1. [] Type or use tab completion to select the **status** property: +++$spooler.Status+++

    The output should return **Running**

1. [] On which service or services does the **spooler** service depend on to run?

    <details>
    <summary>Hint</summary>

    Read through the available members to see if one looks like it would store this information.
    </details>


    <details>
    <summary>Answer</summary>

    ```PowerShell-notab
    $spooler.ServicesDependedOn
    ```

    The dependent services should be: **RPCSS** &  **http**
    </details>

===

# Task 2.2: Executing Object Methods

**Methods** can also be enumerated using **dot notation**, but they show up *after* all properties, so it is usually easier to list them with **Get-Member**.

1. []  Start the notepad process, then use `Get-Process` to store it in a variable named **$Notepad**

    ```PowerShell-notab
    Start-Process Notepad.exe
    $notePad = Get-Process -Name Notepad
    ```

1. [] Using `Get-Member`, find a **method** with the name **Kill**, then try accessing it as if it is a property.

    ```PowerShell-notab
    Get-Member -InputObject $Notepad -Name Kill

    $notePad.Kill
    ```

    Notice that the Notepad.exe process does *not* stop.

    >[!KNOWLEDGE] This illustrates one important **difference** between properties and methods. Methods ***require*** a pair of **parentheses** immediately following the method&#39;s name (no spaces are allowed).

1. [] Try executing the **method** again, but *remember* to use the **parentheses**. This time it should **stop** the process and Notepad should close.

    <details>
    <summary>Answer</summary>

    ```PowerShell-notab
    $notePad.Kill()
    ```
    </details>

1. [] Create a variable named **$LowerString** with a value of **&quot;lowercase string&quot;**.

    ```PowerShell-notab
    $LowerString = &quot;lowercase string&quot;
    ```

1. [] Use **Get-Member** to list the object&#39;s **methods** and determine which one will change the text to **uppercase** letters.

    ```PowerShell-notab
    Get-Member -InputObject $LowerString -MemberType Methods
    ```
    <details>
    <summary>Method Name</summary>
    The **ToUpper()** method
    </details>

1. [] Execute this **method** against **$LowerString** to change the case to uppercase.

    <details>
    <summary>Change the case</summary>

    ```PowerShell-notab
    $LowerString.ToUpper()
    ```
    </details>

1. [] Notice that this does **not** make a **permanent** change to the **$LowerString** variable. The uppercase string was never **saved** back into the variable, so there are no changes. Access **$LowerString** to confirm the value is *still* lowercase.

    ```PowerShell-notab
    $LowerString
    ```
1. [] To make the **change** *and* **store** the result into **$LowerString**, it needs to be re-assigned.

    ```PowerShell-notab
    $LowerString = $LowerString.ToUpper()
    $LowerString
    ```

1. [] There are a number of ways to discover an object&#39;s **type**. Instead of using **Get-Member**, which shows a *lot* of info, the **GetType()** method can be used. **GetType()** exists on **every** object and shows the type. The **name** property can be seen in the default output:

    ```PowerShell-notab
    $proc = Get-Process -Name lsass
    $proc.GetType()
    ```

    | **IsPublic** | **IsSerial** | **Name**    | **BaseType**                    |
|:--|:--|:--|:--|
| True         | False        | **Process** | System.ComponentModel.Component |

1. [] To get the fully qualified name of the **type**, access the **fullname** property of the object *returned* by the method.

    <details>
    <summary>Full name</summary>

    ```PowerShell-notab
    $proc.GetType().fullname
    ```
    **Result:** System.Diagnostics.Process
    </details>

===

# Task 2.3:  Executing Object Methods With a Parameter

Some **methods** require one or more **arguments** to be supplied within their parentheses. This can be thought of *like parameters* passed into a cmdlet.

1. [] Execute +++Get-Date+++ to return the current date and time.

1. [] Using **Get-Member**, discover the data type of the **object** returned by **Get-Date**.

    <details>
    <summary>Get-Date</summary>

    ```PowerShell-notab
    Get-Member -InputObject (Get-Date)
    ```

    System.DateTime
    </details>

1. [] Create a **variable** name **$date** that returns the **current** date.

    <details>
    <summary>Current Date</summary>

    ```PowerShell-notab
    $date = Get-Date
    ```
    </details>

1. [] Using **$date**, display the **methods** of the DateTime type that **start** with the **&quot;Add&quot;**.

    <details>
    <summary>Get-Date Add Methods</summary>

    ```PowerShell-notab
    Get-Member -MemberType method -name Add* -InputObject $date
    ```
    </details>

    Notice that these **methods** require a value, used within the method **parentheses**. The value must be of the specified **data type**.

    | Name | MemberType | Definition |
    |:---|:---|:---|
    |Add| Method |datetime Add(timespan value)|
    |AddDays| Method| datetime AddDays(double value)|
    |AddHours| Method |datetime AddHours(double value)|
    |AddMilliseconds| Method |datetime AddMilliseconds(double value)|
    |AddMinutes |Method |datetime AddMinutes(double value)|
    |AddMonths |Method |datetime AddMonths(int months)|
    |AddSeconds |Method |datetime AddSeconds(double value)|
    |AddTicks |Method |datetime AddTicks(long value)|
    |AddYears |Method |datetime AddYears(int value)|

1. [] Use +++$Date+++ to see its current value. Notice the time might **not** line up, because it stores a **copy** of the data *when the command is executed*.

1. [] **Add** seven days to **$Date**

    <details>
    <summary>Answer</summary>

    ```PowerShell-notab
    $date.AddDays(7)
    ```
    </details>

1. [] **Subtract** one hour from **$Date**

    <details>
    <summary>Answer</summary>

    ```PowerShell-notab
    $date.AddHours(-1)
    ```
    </details>

1. [] **Add** a **timespan** of 10 hours and 30 minutes to **$Date**. A timespan can be represented as **&#39;hh:mm:ss&#39;**.

    <details>
    <summary>Answer</summary>

    ```PowerShell-notab
    $date.Add(&#39;10:30:00&#39;)
    ```
    </details>

1. [] Once again, notice **$Date** has not actually changed. The **values** were just *returned* to the console when running the **methods** above. Why is **$Date** unchanged?

    <details>
    <summary>Answer</summary>

    Creating a variable is just a **copy** of the data *when the command is run*. None of these results were **saved** back into **$Date**

    To save the results, simply use `$Date = ` again

    ```PowerShell-notab
    $date = $date.AddDays(7)
    $date

    $date = $date.AddHours(-1)
    $date
    ```
    </details>


===

# Exercise 3: Working With Strings

Working with **strings** is a common task in PowerShell. There are four **techniques** to create strings in PowerShell: **literal** strings, **expandable** strings, literal here strings and expandable here strings.

**All** of these techniques create a **System.String** object, but behave differently **during creation**.


## Objectives

After completing this exercise, you will be able to:

- Create and manipulate literal and expandable strings.
- Create and manipulate literal and expandable here strings.
- Utilize variable sub-expressions

===

# Task 3.1: Literal and Expandable strings

1. [] **Create** the **variable** to store some string data. This variable will be used to *demonstrate* the difference between **literal** and **expandable** strings. .

    ```PowerShell-notab
    $str = &#39;string&#39;
    ```

1. [] This is an example of a **literal** string, which uses **single quotes**.

    ```PowerShell-notab
    &#39;This is a literal $str&#39;
    ```

    Notice the literal string **ignores** the **$** special character, and the output is **excactly** (literally) what was typed.

1. [] This is an example of an **expandable** string. Expandable string use **double quotes**.

    ```PowerShell-notab
    &quot;This is an expandable $str&quot;
    ```

    Notice the **expandable** string **replaces** the **variable** with its value when it sees the **$** character.

1. [] **Demonstrate** your knowledge of **literal** and **expandable** strings.
   - Create a **variable** named **$eString** with a value of **&#39;expandable string&#39;**
   - Using **$eString**, what code will produce the following result: **This is my expandable string**

    <details>
    <summary>Answer</summary>

    ```PowerShell-notab
    $eString = &#39;expandable string&#39;
    &quot;This is my $eString&quot;
    ```
    </details>

===

# Task 3.2: Literal and Expandable Here strings

A **here-string** interprets **quotation** marks **literally**. they are particularly useful for:

- Text that contains literal quotation marks
- Multiple lines of complex text, such as HTML, XML, or JSON

1. [] **Create** the **variable** that will be used to demonstrate here string behavior.

    ```PowerShell-notab
    $hereStr = &#39;here string&#39;
    ```

1. [] This is an example of a **literal** here string. Here strings require a line break after the opening **@&#39;**
and before the closing **&#39;@**
    ```PowerShell-notab
    $lHereString = @&#39;
    This
    is
    my
    &#39;literal&#39;
    $herestr
    &#39;@
    ```

    ```PowerShell-notab
    $lHereString
    ```

    Observe the single quotes inside the results.

    >[!KNOWLEDGE] Notice the literal here string ignores the **$** special character, just like a regular literal string

1. [] The same **literal** vs **expandable** usage rules apply for **here strings**. Adjust the previous code to expand **$herestr**.

    <details>
    <summary>Answer</summary>
    
    ```PowerShell-notab
    $eHereString = @&quot;
    This
    is
    my
    &quot;expandable&quot;
    $herestr
    &quot;@
    ```

    ```PowerShell-notab
    $eHereString
    ```
    </details>

    >[!KNOWLEDGE] Notice the expandable string replaces the variable with its value

===

# Task 3.3: Variable Sub-Expressions

It is common to use **variables** inside of a string, but often to access specific **properties** of them. This can cause **problems** with the way the variable is **interpreted** by an expandable string.

Variable **Sub-Expressions** can help resolve these issues.


1.  [] Use +++Get-Date+++ to create a variable called **$date** that will be used to demonstrate variable sub expressions.

    The goal will be to have output that looks like:

    ```PowerShell-nocopy-notab-nocolor
    The day of the week is Friday
    ```

    Where Friday is replaced with the current day stored in **$date**

1. [] Try using **properties** from **$date** inside of an **expandable** string to access the day of the week. Observe the output.

    ```PowerShell-notab
    &quot;Today is $date.DayOfWeek&quot;
    ```

1. [] A **Sub-Expression** &quot;**$()**&quot; can help solve this problem. Run this code to see the behavior.

    ```PowerShell-notab
    &quot;Today is $($date.DayOfWeek)&quot;
    ```

1. [] **Create** a variable named **$proc** to store the **lsass** process:

    ```PowerShell-notab
    $proc = Get-Process -Name lsass
    ```

1. [] Using a **variable sub-expression**, display

    ```PowerShell-nocopy-notab-nocolor
    Process ID: XXXX
    ```

    Where XXXX is the actual id number for the lsass process.

    <details>
    <summary>Answer</summary>

    ```PowerShell-notab
    &quot;Process ID: $($proc.id)&quot;
    ```
    </details>

1. [] These are a couple of **examples** of **variable sub-expressions** that are not accessing properties.

    ```PowerShell-notab
    &quot;Date: $(Get-Date)&quot;
    ```

    ```PowerShell-notab
    &quot;10 + 10 = $(10+10)&quot;
    ```

===

# End of lab

## Objects Lab Summary

You have successfully completed this module.

Throughout this module, you have:

- Discovered objects
- Accessed object properties
- Executed object methods
- Creating Literal and Expandable strings and Here strings
- Utilizing variable sub-expressions

Click on **Next** to continue to the (optional) self test.

===

# Self test (Optional part of the course)

## Self test information

The following self test is an optional part of this course and can be used to evaluate if your knowledge of the subject matter is sufficient. You can use this self test to re-evaluate your knowledge after taking the course or test your knowledge before you take / retake the course.

The self test consists of 10 questions/exercises. For best results, it is recommended to complete this self test without referring back to the previous materials or other resources.

##  Self test duration

Although the self test is not timed this test should be completed in approximately 15 minutes.

To start the self test continue to the next page.

===

## Self test

1. <Removed>
___
2. <Removed>
___
3. <Removed>
___
4. <Removed>
___
5. <Removed>
___
6. <Removed>
___
7. <Removed>
___
8. <Removed>
___
9. <Removed>
___
10. <Removed>

">
    <input type="hidden" id="activities" value="[]">
    <input type="hidden" id="replacementTokens" value="[{&quot;Token&quot;:&quot;@lab.LabProfile.Id&quot;,&quot;Replacement&quot;:&quot;38671&quot;},{&quot;Token&quot;:&quot;@lab.CtrlAltDelete&quot;,&quot;Replacement&quot;:&quot;&lt;a href=&#39;#&#39; class=&#39;ctrlAltDeleteLink&#39;&gt;Ctrl+Alt+Delete&lt;/a&gt;&quot;},{&quot;Token&quot;:&quot;@lab.VirtualMachine(WIN10).SelectLink&quot;,&quot;Replacement&quot;:&quot;&lt;a href=&#39;#&#39; class=&#39;selectMachineLink&#39; data-data=&#39;63124&#39;&gt;WIN10&lt;/a&gt;&quot;},{&quot;Token&quot;:&quot;@lab.VirtualMachine(WIN10).Username&quot;,&quot;Replacement&quot;:&quot;Power&quot;},{&quot;Token&quot;:&quot;@lab.VirtualMachine(WIN10).Password&quot;,&quot;Replacement&quot;:&quot;Pa$$$$w0rd&quot;},{&quot;Token&quot;:&quot;@lab.VirtualMachine(MS).SelectLink&quot;,&quot;Replacement&quot;:&quot;&lt;a href=&#39;#&#39; class=&#39;selectMachineLink&#39; data-data=&#39;54597&#39;&gt;MS&lt;/a&gt;&quot;},{&quot;Token&quot;:&quot;@lab.VirtualMachine(MS).Username&quot;,&quot;Replacement&quot;:&quot;Power&quot;},{&quot;Token&quot;:&quot;@lab.VirtualMachine(MS).Password&quot;,&quot;Replacement&quot;:&quot;Pa$$$$w0rd&quot;},{&quot;Token&quot;:&quot;@lab.VirtualMachine(DC).SelectLink&quot;,&quot;Replacement&quot;:&quot;&lt;a href=&#39;#&#39; class=&#39;selectMachineLink&#39; data-data=&#39;54598&#39;&gt;DC&lt;/a&gt;&quot;},{&quot;Token&quot;:&quot;@lab.VirtualMachine(DC).Username&quot;,&quot;Replacement&quot;:&quot;Administrator&quot;},{&quot;Token&quot;:&quot;@lab.VirtualMachine(DC).Password&quot;,&quot;Replacement&quot;:&quot;Pa$$$$w0rd&quot;},{&quot;Token&quot;:&quot;@lab.OpticalMedia(5638).LoadLink&quot;,&quot;Replacement&quot;:&quot;&lt;a href=&#39;#&#39; class=&#39;loadMediaLink opticalMedia&#39; data-data=&#39;5638&#39;&gt;Introduction to Commands - 0050&lt;/a&gt;&quot;},{&quot;Token&quot;:&quot;@lab.LabInstance.Id&quot;,&quot;Replacement&quot;:&quot;[ID]&quot;},{&quot;Token&quot;:&quot;@lab.LabInstance.GlobalId&quot;,&quot;Replacement&quot;:&quot;[lodID]&quot;},{&quot;Token&quot;:&quot;@lab.LabInstance.StartDate&quot;,&quot;Replacement&quot;:&quot;20190108&quot;},{&quot;Token&quot;:&quot;@lab.User.Id&quot;,&quot;Replacement&quot;:&quot;[USERID]&quot;},{&quot;Token&quot;:&quot;@lab.User.FirstName&quot;,&quot;Replacement&quot;:&quot;[FIRSTNAME]&quot;},{&quot;Token&quot;:&quot;@lab.User.LastName&quot;,&quot;Replacement&quot;:&quot;[LASTNAME]&quot;},{&quot;Token&quot;:&quot;@lab.User.Email&quot;,&quot;Replacement&quot;:&quot;[EMAIL]&quot;},{&quot;Token&quot;:&quot;@lab.User.ExternalId&quot;,&quot;Replacement&quot;:&quot;[EXTERNALID]&quot;},{&quot;Token&quot;:&quot;@lab.Tag&quot;,&quot;Replacement&quot;:&quot;[TAG]&quot;}]">

    <textarea id="copyInput" value="" style="position: absolute; left:-10000px; top:-10000px; "></textarea>

    <script type="text/javascript"> 
    
        String.prototype.replaceAll = function(search, replacement) {
            var target = this;
            return target.replace(new RegExp(search, 'g'), replacement);
        };

        var childWindows = [];

        function showClickFeedbackMessage(text, x, y, duration) {
            var $message = $("<div class='clickFeedbackMessage noselect'>" + text + "</div>");
            $message.appendTo($("body")).hide();
            $message.css({ left: x, top: y });
            $message.fadeIn("fast");
            window.setTimeout(function () {
                $message.fadeOut("fast", function () { $message.remove(); });
            }, duration);
        }

        function copyableClicked(element) {
            //only copy if we are clicking, not if we have used the mouse to select the text manually.
            var selectedText;
            if (window.getSelection) {
                selectedText = window.getSelection().toString();
            } else if (document.selection && document.selection.type !== "Control") {
                selectedText = document.selection.createRange().text;
            }
            if (selectedText) { return };

            var $element = $(element);
            var text = $element.text();
            $("#copyInput").val(text).select();
            var offset = $element.offset();
            var x = offset.left;
            var y = offset.top - 40;
            try {
                var successful = document.execCommand("copy");
                if (successful) {
                    showClickFeedbackMessage("Copied to clipboard", x, y, 2000);
                } else {
                    showClickFeedbackMessage("Copying was unsuccessful", x, y, 2000);
                }
            } catch (err) {
                showClickFeedbackMessage("Copying was unsuccessful", x, y, 2000);
                console.log("Unable to copy. " + err);
            }
        }

        function setupKnowledgeExpanders() {
            $(".knowledge").each(function () {
                var knowledge = this;
                var $knowledge = $(this);
                var $moreKnowledge = $knowledge.next();
                if ($moreKnowledge.is(".moreKnowledge")) {
                    var maxHeight = 100;
                    var leeway = 100;
                    var diff = knowledge.scrollHeight - maxHeight;
                    if (diff < leeway) {
                        $knowledge.removeClass("collapsed");
                        $moreKnowledge.find("a").hide();
                    } else {
                        //this is tall content, let's show the 'more' link
                        $moreKnowledge.find("a").show();
                        $knowledge.addClass("collapsed");
                    }
                }
            });
        }

        var variables = {};

        function processVariables() {
            $("span.variable").each(function () {
                var $this = $(this);
                var name = $this.attr("data-name");
                if (name in variables) {
                    $this.html(variables[name]);
                } else {
                    $this.text("<" + name + ">");
                }
            });
            $("input.variableTextBox").each(function () {
                var $this = $(this);
                var name = $this.attr("data-name");
                if (name in variables) {
                    $this.val(variables[name]);
                } else {
                    $this.val("");
                }
            });
            $("code").each(function () {
                var originalHtml = this.originalHtml ? this.originalHtml : this.innerHTML;
                var newHtml = originalHtml;
                for (var name in variables) {
                    var val = variables[name];
                    var regex = new RegExp('<span class="nocode">&lt;' + name + '&gt;</span>', 'g');
                    newHtml = newHtml.replace(regex, val);
                }
                if (originalHtml != newHtml || originalHtml != this.innerHTML) {
                    this.originalHtml = originalHtml;
                    this.innerHTML = newHtml;
                }
            });
        }
        
        window.onload = function () {

            var rawContent = document.getElementById("rawContent").value;
            var contentRoot = "./Content/"
            var activitiesString = document.getElementById("activities").value;
            var activities = (activitiesString == null || activitiesString.length == 0) ? [] : JSON.parse(activitiesString);
            var replacementTokensString = document.getElementById("replacementTokens").value;
            var replacementTokens = (replacementTokensString == null || replacementTokensString.length == 0) ? [] : JSON.parse(replacementTokensString);
            instructionsProcessor.process(rawContent, "instructions", false, contentRoot, replacementTokens,
                function ($page) {
                    setupKnowledgeExpanders();
                },
                activities
            );
            $(".page").each(function () {
                var $page = $(this);
                if ($page.find("iframe.externalManual").length > 0) {
                    $page.css("padding", 0);
                }
            });

            $("body").on("click", ".moreKnowledgeLink", function (e) {
                e.preventDefault();
                var $link = $(this);
                var $knowledge = $link.parent().prev();
                if ($knowledge.hasClass("expanded")) {
                    $knowledge.removeClass("expanded");
                    $link.text("more...");
                } else {
                    $knowledge.addClass("expanded");
                    $link.text("...less");
                }
            }).on("click", ".copyable, code:not(.nocopy)", function (e) {
                copyableClicked(this);
            }).on("click", ".dialogLink", function (e) {
                e.preventDefault();
                e.stopImmediatePropagation();
                var $dialogLink = $(this);
                var title = $dialogLink.attr("title");
                var target = $dialogLink.attr("data-target");
                if (target) {
                    var $hiddenDialog = $("blockquote.referenceContent[data-id='" + target + "']");
                    if ($hiddenDialog.length === 0) {
                        alert('CONTENT ERROR: Unable to find a reference content "' + target + '"');
                    } else {
                        showDialog({title:title, content: $hiddenDialog.html() });
                    }
                }
                else {
                    showDialog({title:title, url: $dialogLink.attr("href"), isInstructions: $dialogLink.hasClass("instructions") });
                }
            }).on("click", ".videoLink, video", function (e) {
                e.preventDefault();
                var videoUrl = $(this).hasClass("videoLink") ? this.href : this.src;
                var url = "./Content/" + videoUrl.split('Content/').pop().replace(/\#(.*?)$/, '').replace(/\?(.*?)$/, '')
                if (this.title) {
                    
                }
                var videoWindow = window.open(url, "videoWindow", "menubar=no,location=no,resizable=yes,scrollbars=yes,status=no");
                childWindows.push(videoWindow);
                try {
                    videoWindow.focus();
                } catch (e) {

                }
            }).on("click", ".imageLink, img", function (e) {
                var $this = $(this);
                if ($this.parent().is("a")) return;
                e.preventDefault();
                e.stopImmediatePropagation();
                var imgUrl = $this.hasClass("imageLink") ? this.href : this.src;
                var url = "./Content/" + imgUrl.split('Content/').pop().replace(/\#(.*?)$/, '').replace(/\?(.*?)$/, '')
                if (this.title) {
                    
                }
                var imageWindow = window.open(url, "imageWindow", "menubar=no,location=no,resizable=yes,scrollbars=yes,status=no");
                childWindows.push(imageWindow);
                try {
                    imageWindow.focus();
                } catch (e) {

                }
            }).on("click", ".tipLink", function (e) {
                e.preventDefault();
                var $tiplink = $(this);
                var $hiddenTip = $tiplink.next();
                var offset = $(this).offset();
                var x = offset.left;
                var y = offset.top + 25;
                showClickFeedbackMessage($hiddenTip.html().replaceAll('<code title="Copy to clipboard" class="prettyprint">','<code title="Copy to clipboard" style="background-color:#8888;" class="prettyprint">').replaceAll("class",'style="background-color:#8888;" class'), x, y, 5000);
            }).on("change", ".variableTextBox", function () {
                var $textBox = $(this);
                var name = $textBox.attr("data-name");
                var val = $textBox.val();
                if (val == null || val.length == 0) {
                    if (name in variables) {
                        delete variables[name];
                    }
                } else {
                    variables[name] = val;
                }
                processVariables();
            });;

            $(window).resize(function () {
                setupKnowledgeExpanders();
            }).unload(function () {
                closeAllChildWindows();
            });

            function closeAllChildWindows() {
                for (var i = 0; i < childWindows.length; i++) {
                    try {
                        childWindows[i].close();
                    } catch (e) {
                    }
                }
                childWindows = [];
            }

            function showDialog(options) {
                if (!options) return;
                var $dialog = $("#modalDialog");
                var isUpdatedContent = false;
                if ($dialog.length > 0) {
                    $dialog.find(".dialogContent").html("");
                    $dialog.find(".dialogButtons").html("");
                    isUpdatedContent = true;
                } else {
                    var $dialog = $('<div id="modalDialog" class="dialog"><div class="dialogMask"></div><div class="dialogBox"><div class="dialogCloseButton"></div><div class="dialogTitle"></div><div class="dialogContent"></div><div class="dialogButtons"></div></div></div>');
                }
                var $dialogBox = $dialog.find(".dialogBox");
                var close = function () {
                    var h = $dialogBox.outerHeight();
                    var offset = $dialogBox.offset();
                    $dialogBox.css("marginTop", 0).animate({ marginTop: -h - offset.top }, 300);
                    $dialog.delay(200).fadeOut("fast", function () { $dialog.remove(); });
                }
                $dialog.find(".dialogCloseButton").click(close);

                if (options.title) {
                    $dialog.find(".dialogTitle").html(options.title).show();
                } else {
                    $dialog.find(".dialogTitle").hide();
                    $dialog.addClass("noTitle");
                }
                if (options.content) {
                    $dialog.find(".dialogContent").removeClass("noScroll").append(options.content);
                } else if (options.url) {
                    var urlLower = options.url.toLowerCase();
                    if (urlLower.indexOf(".mp4") !== -1) {
                        $dialog.find(".dialogContent").removeClass("noScroll").append('<video src="' + options.url + '" controls autoplay></video>');
                        var $video = $("#contentDialogVideo");
                        try {
                            $video[0].play();
                        } catch (e) {
                            //
                        }
                    } else if (urlLower.indexOf(".png") !== -1 || urlLower.indexOf(".jpg") !== -1 || urlLower.indexOf(".jpeg") !== -1 || urlLower.indexOf(".gif") !== -1) {
                        $dialog.find(".dialogContent").removeClass("noScroll").append('<img src="' + options.url + '" controls></iframe>');
                    } else if (options.isInstructions || urlLower.indexOf(".md") !== -1) {
                        $dialog.find(".dialogContent").removeClass("noScroll").append('<div id="instructionsDialog"></div>');
                        window.setTimeout(function () {
                            instructionsProcessor.processUrl(options.url, "instructionsDialog");
                            if (options.url.indexOf("#") >= 0) {
                                window.setTimeout(function () {
                                    var hash = options.url.substr(options.url.indexOf("#"));
                                    var $element = $("#instructionsDialog " + hash);
                                    if ($element.length > 0) {
                                        $dialog.find(".dialogContent").scrollTop($element.position().top);
                                    }
                                }, 400); //leave time for the content to layout... the dialog takes 400ms to animate anyway, which should be sufficient.
                            }
                        }, 1);
                    } else {
                        $dialog.find(".dialogContent").addClass("noScroll").append('<iframe id="contentDialogIFrame" src="' + options.url + '" style="width:100%;height:100%;border:none;" allowfullscreen></iframe>');
                    }
                } else {
                    $dialog.find(".dialogContent").hide();
                }
                if (options.buttons && options.buttons.length > 0) {
                    $dialog.addClass("hasButtons");
                    var $dialogButtons = $dialog.find(".dialogButtons");
                    var numButtons = options.buttons.length;
                    for (var i = 0; i < numButtons; i++) {
                        var button = options.buttons[i];
                        var $button = $("<input type='button' value='" + button.text + "' />");
                        if (button.click) {
                            $button.click(button.click);
                        }
                        if (button.primary) {
                            $button.addClass("primary");
                        }
                        if (button.closeDialog) {
                            $button.click(close);
                        }
                        $dialogButtons.append($button);
                    }
                }
                if (!isUpdatedContent) {
                    $("body").append($dialog);
                    $dialog.hide().fadeIn("fast", function () {
                        if (options.open) {
                            options.open();
                        }
                    });
                    var h = $dialogBox.outerHeight();
                    var offset = $dialogBox.offset();
                    $dialogBox.css("marginTop", -h - offset.top).animate({ marginTop: 0 }, 400);
                }
                return {
                    close: close
                };
            }

        }

        function getScrollTop() {
            return document.body.scrollTop;
        }

    </script>


</body>
</html>
